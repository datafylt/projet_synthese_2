{% extends 'base.html' %}

{% block title %}
Gear Analysis
{% endblock %}

{% block custom_css %}
<!-- Custom CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
<!-- PhotoSwipe CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css">
{% endblock %}

{% block body %}
<!-- nav bar -->
<nav class="navbar navbar-expand-lg navbar-light shadow fixed-top" style="background-color: #e3f2fd;">
    <a class="navbar-brand" href="/">Industrial Image Detection</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
            </li>
              <li class="nav-item active">
                <a class="nav-link" href="/prediction">Prediction</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/analysis">Analysis</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="https://github.com/datafylt/projet_synthese_2">source code</a>
            </li>
        </ul>
    </div>
</nav>
<div class="container mt-5 welcome-text">
    <div class="row">
        <div class="col-lg-12">
            <h1>Welcome to the Gear Analysis Tool</h1>
            <p>In the manufacturing industry, reducing processing errors in the manufacturing process is important for
                maximizing profits. In order to reduce processing errors, it is necessary to secure a budget for quality
                assurance, implement manual inspection work, and review the manufacturing process. Particularly, the
                inspection process is carried out by many companies, but there are problems such as uneven accuracy
                depending on inspection workers and increased labor costs.</p>
        </div>
    </div>
</div>
<!-- nav bar ends -->

<!-- Flash messages section -->
<div class="container">
    <div class="row">
        <div class="col-12">
            {% if predictions %}
            <div class="scrollable-grid-container">
                <h3 class="prediction-results-title">Prediction Results</h3>
                <div class="image-predictions-grid">
                    {% for prediction in predictions %}
                    <div class="image-prediction">
                        <h5>{{ prediction.filename }}</h5>
                        <p>Prediction: {{ prediction.prediction_label }} - {{ prediction.prediction_val }}</p>
                        <img class="grid-image" src="/webapp/predicted_images/{{ prediction.image_path }}" alt="Processed Image">
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <p>No prediction results to display.</p>
            {% endif %}
        </div>
    </div>

</div>


<div class="container-fluid masthead">
    <br><br><br><br>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="row">
                    <form method="POST" action="/" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="fileUpload">
                                <blockquote class="blockquote">
                                    <p class="mb-2">Select file/s for prediction</p>
                                </blockquote>
                            </label>
                            <div class="form-group d-flex align-items-center">
                                <input type="file" class="form-control-file mr-2" name="picture" id="fileUpload"
                                       multiple onchange="previewImages();" accept="image/*">
                                <button type="submit" class="btn btn-primary mb-2">Predict</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="container mt-4">
                    <div class="row">
                        <div class="col-lg-12">
                            <div id="imagePreviews" class="my-gallery">
                                <!-- Uploaded images will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. PhotoSwipe keeps only 3 of them in the DOM to save memory.
             Do not modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

{% endblock %}

{% block custom_js %}
<!-- Include Bootstrap JS and its dependencies -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.9.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- PhotoSwipe JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<!-- Custom JS for initializing PhotoSwipe -->
<script src="{{ url_for('static', filename='script/index.js') }}"></script>
{% endblock %}
